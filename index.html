<!DOCTYPE html>
<html lang="en">
<head>
</head>
<body>
  <!-- Your content here -->
  
  <script>
    const url = "https://tle.ivanstanojevic.me/api/tle/49044";
    var loc;
    var weatherURL;
    var nextValidTime;
    const validWeathers = ["Partly Cloudy", "Sunny"]
    async function getTLE(){
        const result =await fetch(url);
        console.log("yippeeee");
        result.json().then(json=>{console.log(json);})
    }
    async function getLoc(){
      await fetch("https://ipinfo.io/json?token=32edddcb4e3546").then(
      (response) => response.json()
      ).then(
      (jsonResponse) => loc=jsonResponse.loc
      )
      console.log(loc)
    }
    async function getWeather(){
      try{
         await fetch("https://api.weather.gov/points/" + loc).then((response) => response.json()).then((jsonResponse) => weather = jsonResponse.properties.forecast)
      }
      catch{
         //assumes that adding one to lat and long will make a valid location for the NWS api
      }
      const weatherForecasts = []
      await fetch(weatherURL).then((response) => response.json()).then((jsonResponse) => 
      {for(let i = 0; i < 14; i++){
         weatherForecasts[i] = [jsonResponse.properties.periods[i].shortForecast, jsonResponse.properties.periods[i].isDaytime]
      }}
      )
      nextValidTime = 0; //Next valid time is stored in ~12 hour increments, up to a week in the future. If next valid time is 0, the weather conditions are clear enough to see a satellite now
      for(let i = 0; i < 14; i++){
         if(weatherForecasts[i][0] in validWeathers){
            if(!weatherForecasts[i][1]){
               nextValidTime = i;
               break;
            }
         }
      }
    }
    function canISee(nvt, uLoc, sLoc){
      if (nvt != 0){
         return false
      }
      satRange = [[uLoc[0] - 90, uLoc[1] + 90], [uLoc[1] - 45, uLoc[1] + 45]];
      if((satLoc[0] > satRange[0][0]) && (satLoc[0] < satRange[0][1]) && (satLoc[1] > satRange[1][0]) && (satLoc[1] < satrange[1][1]))
      {
         return true;
      }
      return false;
    }
    getLoc();
    getTLE();
    getWeather();
  </script>
</body>
</html>
